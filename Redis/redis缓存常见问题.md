---
title: redis缓存雪崩、穿透、击穿
tags: [redis] 
categories:
	- redis
type : "tags"
---



#### 缓存雪崩

雪崩故名思义就是大面积崩塌(个人理解),在缓存中就是说在某一时间缓存大规模失效,简称缓存雪崩。一般出现缓存雪崩的情况归属于两种情况:

- 服务宕机,如redis服务突然崩溃导致导致所有缓存不能使用
- 缓存数据失效时间过于集中,比如一批数据都设置2分钟或5分钟失效可能在某一时刻部分数据失效

缓存雪崩会导数据库在某一个时刻介绍过大的请求,特别是QPS比较高的系统,会是一个很大的问题。

解决缓存雪崩的方法:

- 服务宕机
	1.使用集群服务来保证缓存服务的高可用,比如redis使用主从+哨兵,RedisCluster来避免Redis服务崩溃的情况
    2.增加ehcache缓存来防止redis在崩溃时所有请求全部进行数据库,
    3.ehcache本地缓存 + [Hystrix](https://github.com/Netflix/Hystrix)限流&降级

- 数据失效时间过于集中
	1.设置数据失效时间错开,热数据的实效时间可以尽量分散设置,冷数据的实效时间可以尽量设置久些
	2.设置互斥锁,当发现数据开始进入数据库查询时进行互斥锁的增加,其余查询都会等待,直到锁释放,当后面发现在缓存中存在数据就不会再进行数据库查询,这种做法将会阻塞其他线程,系统吞吐量会下降,需要考虑

---

#### 缓存穿透

穿透故名思义就是无视(个人理解),当缓存被无视时,那么缓存存在的意义就不大了,正常来说当执行一个查询首先会进行缓存查询,缓存不存在才会去数据库中查询到然后再放进缓存,下次再查询就不会进行数据库访问了,
正常来说数据查询的数据在数据库中都是存在的,那么查询时缓存没有也会在查询到结果后放进缓存来保证下次查询缓存存在,但是当数据库中不存在,那么缓存也就实效了。

缓存穿透带来的问题会是很严重的,假如有人恶心攻击你的系统,拿着一批不存在的数据id然后并发性的进行数据库查询,因为数据库中不存在该批数据,所以所有的请求全部都会进入数据库,对于数据库是一个可怕的问题.

解决缓存穿透的方法:

- 缓存null值在缓存中,当进来一批数据进行数据库查询没有查询到结果时,那么将该id设置null值到缓存中,并添加实效时间,这样就可以保证在一段时间再进行该值查询时直接返回null,但是这样避免不了使用类似uuid这种批量查询那么会导致缓存中会一直在增长无效的数据,如果缓存设置持久化也会在短时间导致磁盘空间占用上涨
- 使用BloomFilter进行过滤,BloomFilter类似于一个hbase set 用来判断某个元素(key)是否存在于某个集合中

---

#### 缓存击穿

缓存击穿是我们一般会在QPS比较高的系统遇到的,当一个热点的key瞬间实效,那么大量的请求就会进入数据库中,这种现象就被称为缓存击穿。这种问题带来的后果会给数据库在某一时刻带来巨大的压力。

解决缓存穿透的方法:

- 当有发现一个key实效时,那么在进行数据库查询的线程添加排斥锁,查询结束后将数据重新放进缓存,后续的线程再来查询时就会发现缓存中的数据已存在。

#### 查询文档

[缓存雪崩、穿透、击穿](https://juejin.im/post/5c9a67ac6fb9a070cb24bf34)